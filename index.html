
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily's Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://aistudiocdn.com/react@^19.1.1",
        "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
        "react/": "https://aistudiocdn.com/react@^19.1.1/"
      }
    }
    </script>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useCallback, useMemo } from 'react';
      import ReactDOM from 'react-dom/client';

      // --- From constants.ts ---
      const TOWERS = ["T1", "T2", "T3", "T4", "T5"];
      const TASKS = [
        "Subrough", "Water", "Drainage", "Fire & Nail", "Tubs", 
        "Gas", "Heaters", "Water Main", "Finishs",
      ];

      // --- Icon Components ---
      const PlusIcon = ({ className = 'w-5 h-5' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 4v16m8-8H4" />
          </svg>
      );
      const PencilIcon = ({ className = 'w-5 h-5' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
      );
      const TrashIcon = ({ className = 'w-5 h-5' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
      );
      const ExportIcon = ({ className = 'w-5 h-5' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
          </svg>
      );
      const ClockIcon = ({ className = 'w-6 h-6' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
      );
      const CheckCircleIcon = ({ className = 'w-6 h-6' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
      );
      const PlusCircleIcon = ({ className = 'w-6 h-6' }) => (
          <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
              <path strokeLinecap="round" strokeLinejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
      );

      // --- From components/SummaryStats.tsx ---
      const StatCard = ({ icon, label, value, color }) => (
          <div className={`flex items-center p-4 bg-white rounded-xl shadow-lg border-l-4 ${color}`}>
              <div className="mr-4 text-slate-600">
                  {icon}
              </div>
              <div>
                  <p className="text-sm font-medium text-slate-500">{label}</p>
                  <p className="text-2xl font-bold text-slate-800">{value}</p>
              </div>
          </div>
      );

      const SummaryStats = ({ totalHours, totalUnits, totalChangeOrders }) => {
          return (
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                  <StatCard 
                      icon={<ClockIcon className="w-8 h-8" />}
                      label="Total Hours"
                      value={totalHours.toFixed(1)}
                      color="border-sky-500"
                  />
                  <StatCard 
                      icon={<CheckCircleIcon className="w-8 h-8" />}
                      label="Total Units Completed"
                      value={totalUnits}
                      color="border-emerald-500"
                  />
                  <StatCard 
                      icon={<PlusCircleIcon className="w-8 h-8" />}
                      label="Total Change Orders"
                      value={totalChangeOrders.toFixed(1)}
                      color="border-amber-500"
                  />
              </div>
          );
      };

      // --- From components/JobTable.tsx ---
      const JobTable = ({ entries, handleEdit, handleDelete }) => {
          if (entries.length === 0) {
              return (
                  <div className="text-center py-16 bg-white shadow-lg rounded-xl">
                      <h3 className="text-xl font-semibold text-slate-700">No Entries Yet</h3>
                      <p className="text-slate-500 mt-2">Add a new entry using the form above to get started.</p>
                  </div>
              );
          }

          return (
              <div className="bg-white shadow-lg rounded-xl overflow-hidden">
                  <div className="overflow-x-auto">
                      <table className="min-w-full divide-y divide-slate-200">
                          <thead className="bg-slate-50">
                              <tr>
                                  {['Date', 'Tower', 'Task', 'Hours', 'Units', 'Notes', 'Change Orders'].map(header => (
                                      <th key={header} scope="col" className="px-6 py-3 text-left text-xs font-semibold text-slate-500 uppercase tracking-wider">
                                          {header}
                                      </th>
                                  ))}
                                  <th scope="col" className="relative px-6 py-3">
                                      <span className="sr-only">Actions</span>
                                  </th>
                              </tr>
                          </thead>
                          <tbody className="bg-white divide-y divide-slate-200">
                              {entries.map((entry) => (
                                  <tr key={entry.id} className="hover:bg-slate-50 transition-colors duration-150">
                                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">{entry.date}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600">{entry.tower}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600">{entry.task}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600 text-center">{entry.hours}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600 text-center">{entry.unitsCompleted}</td>
                                      <td className="px-6 py-4 text-sm text-slate-600 max-w-xs truncate" title={entry.notes}>{entry.notes}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-sm text-slate-600 text-center">{entry.changeOrders}</td>
                                      <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                          <button
                                              onClick={() => handleEdit(entry.id)}
                                              className="text-indigo-600 hover:text-indigo-900 mr-4 transition-colors duration-150"
                                              aria-label={`Edit entry for ${entry.date}`}
                                          >
                                              <PencilIcon />
                                          </button>
                                          <button 
                                              onClick={() => handleDelete(entry.id)} 
                                              className="text-red-600 hover:text-red-900 transition-colors duration-150"
                                              aria-label={`Delete entry for ${entry.date}`}
                                          >
                                              <TrashIcon />
                                          </button>
                                      </td>
                                  </tr>
                              ))}
                          </tbody>
                      </table>
                  </div>
              </div>
          );
      };

      // --- From components/JobForm.tsx ---
      const InputField = ({ label, id, error, ...props }) => (
          <div>
              <label htmlFor={id} className="block text-sm font-medium text-slate-600 mb-1">{label}</label>
              <input
                  id={id}
                  {...props}
                  className={`block w-full text-sm rounded-md shadow-sm transition duration-150 ease-in-out bg-white text-black p-2 border ${error ? 'border-red-500 ring-red-500' : 'border-slate-300 focus:border-indigo-500 focus:ring-indigo-500'}`}
                  aria-invalid={!!error}
                  aria-describedby={error ? `${id}-error` : undefined}
              />
              {error && <p id={`${id}-error`} className="text-red-600 text-xs mt-1">{error}</p>}
          </div>
      );

      const JobForm = ({ formData, setFormData, handleSubmit, editingId, loading, onExport, cancelEdit, errors, setErrors }) => {

          const handleInputChange = (e) => {
              const { id, value } = e.target;
              setFormData(prev => ({ ...prev, [id]: value }));

              if (errors[id]) {
                  setErrors(prevErrors => {
                      const newErrors = { ...prevErrors };
                      delete newErrors[id];
                      return newErrors;
                  });
              }
          };

          return (
              <div className="bg-white shadow-lg rounded-xl p-6 mb-8">
                  <h1 className="text-3xl font-bold text-slate-800 mb-2">Daily's Tracker</h1>
                  <p className="text-slate-500 mb-6">Enter daily job details to maintain a comprehensive log.</p>
                  
                  <form onSubmit={handleSubmit} className="space-y-4" noValidate>
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                          <InputField label="Date" id="date" type="date" required value={formData.date} onChange={handleInputChange} error={errors.date} />
                          
                          <div>
                              <label htmlFor="tower" className="block text-sm font-medium text-slate-600 mb-1">Tower</label>
                              <select
                                  id="tower"
                                  required
                                  value={formData.tower}
                                  onChange={handleInputChange}
                                  className={`block w-full text-sm rounded-md shadow-sm transition duration-150 ease-in-out bg-white text-black p-2 border ${errors.tower ? 'border-red-500 ring-red-500' : 'border-slate-300 focus:border-indigo-500 focus:ring-indigo-500'}`}
                                  aria-invalid={!!errors.tower}
                                  aria-describedby={errors.tower ? 'tower-error' : undefined}
                              >
                                  <option value="">Select a Tower</option>
                                  {TOWERS.map((tower) => (
                                      <option key={tower} value={tower}>{tower}</option>
                                  ))}
                              </select>
                              {errors.tower && <p id="tower-error" className="text-red-600 text-xs mt-1">{errors.tower}</p>}
                          </div>

                          <div>
                              <label htmlFor="task" className="block text-sm font-medium text-slate-600 mb-1">Task</label>
                              <select
                                  id="task"
                                  required
                                  value={formData.task}
                                  onChange={handleInputChange}
                                  className={`block w-full text-sm rounded-md shadow-sm transition duration-150 ease-in-out bg-white text-black p-2 border ${errors.task ? 'border-red-500 ring-red-500' : 'border-slate-300 focus:border-indigo-500 focus:ring-indigo-500'}`}
                                  aria-invalid={!!errors.task}
                                  aria-describedby={errors.task ? 'task-error' : undefined}
                              >
                                  <option value="">Select a Task</option>
                                  {TASKS.map((task) => (
                                      <option key={task} value={task}>{task}</option>
                                  ))}
                              </select>
                              {errors.task && <p id="task-error" className="text-red-600 text-xs mt-1">{errors.task}</p>}
                          </div>

                          <InputField label="Hours" id="hours" type="number" required step="0.1" min="0" value={formData.hours} onChange={handleInputChange} error={errors.hours} />
                          <InputField label="Units Completed" id="units" type="number" required step="1" min="0" value={formData.units} onChange={handleInputChange} error={errors.units} />
                          <InputField label="Change Orders" id="changeOrders" type="number" step="0.1" min="0" value={formData.changeOrders} onChange={handleInputChange} error={errors.changeOrders} />
                          
                          <div className="md:col-span-2 lg:col-span-3">
                              <label htmlFor="notes" className="block text-sm font-medium text-slate-600 mb-1">Notes</label>
                              <textarea
                                  id="notes"
                                  rows={1}
                                  value={formData.notes}
                                  onChange={handleInputChange}
                                  className="block w-full text-sm rounded-md border-slate-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out bg-white text-black p-2 border"
                              />
                          </div>
                      </div>

                      <div className="flex flex-col sm:flex-row justify-end items-center mt-6 pt-4 border-t border-slate-200 space-y-2 sm:space-y-0 sm:space-x-3">
                          <button
                              type="button"
                              onClick={onExport}
                              className="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 border border-slate-300 shadow-sm text-sm font-medium rounded-md text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all"
                          >
                              <ExportIcon />
                              Export CSV
                          </button>
                          {editingId && (
                              <button
                                  type="button"
                                  onClick={cancelEdit}
                                  className="w-full sm:w-auto inline-flex justify-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-slate-700 bg-slate-200 hover:bg-slate-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500 transition-all"
                              >
                                  Cancel Edit
                              </button>
                          )}
                          <button
                              type="submit"
                              disabled={loading}
                              className="w-full sm:w-auto inline-flex items-center justify-center gap-2 px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                          >
                              {editingId ? <PencilIcon /> : <PlusIcon />}
                              {loading ? 'Saving...' : editingId ? 'Update Entry' : 'Add Entry'}
                          </button>
                      </div>
                  </form>
              </div>
          );
      };

      // --- From App.tsx ---
      const App = () => {
          const INITIAL_FORM_STATE = {
              date: new Date().toISOString().split("T")[0],
              tower: "",
              task: "",
              hours: "",
              units: "",
              notes: "",
              changeOrders: "",
          };

          const LOCAL_STORAGE_KEY = "jobDailiesEntries";

          const [entries, setEntries] = useState([]);
          const [loading, setLoading] = useState(false);
          const [editingId, setEditingId] = useState(null);
          const [formData, setFormData] = useState(INITIAL_FORM_STATE);
          const [errors, setErrors] = useState({});

          useEffect(() => {
              try {
                  const savedEntries = localStorage.getItem(LOCAL_STORAGE_KEY);
                  if (savedEntries) {
                      const parsedEntries = JSON.parse(savedEntries);
                      parsedEntries.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
                      setEntries(parsedEntries);
                  }
              } catch (error) {
                  console.error("Error loading data from local storage:", error);
              }
          }, []);

          const saveToLocalStorage = useCallback((newEntries) => {
              localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newEntries));
          }, []);
          
          const resetForm = useCallback(() => {
              setFormData(INITIAL_FORM_STATE);
              setEditingId(null);
              setErrors({});
          }, []);

          const validateForm = useCallback((data) => {
              const newErrors = {};

              const today = new Date();
              const inputDate = new Date(data.date);
              today.setHours(0, 0, 0, 0);
              inputDate.setUTCHours(0, 0, 0, 0);

              if (!data.date) {
                  newErrors.date = "Date is required.";
              } else if (inputDate > today) {
                  newErrors.date = "Date cannot be in the future.";
              }
              
              if (!data.tower) newErrors.tower = "Tower is required.";
              if (!data.task) newErrors.task = "Task is required.";

              const hours = Number(data.hours);
              if (data.hours === "") {
                  newErrors.hours = "Hours is required.";
              } else if (isNaN(hours) || hours < 0) {
                  newErrors.hours = "Hours must be a non-negative number.";
              }

              const units = Number(data.units);
              if (data.units === "") {
                  newErrors.units = "Units Completed is required.";
              } else if (isNaN(units) || units < 0) {
                  newErrors.units = "Units must be a non-negative number.";
              }

              const changeOrders = Number(data.changeOrders);
              if (data.changeOrders !== "" && (isNaN(changeOrders) || changeOrders < 0)) {
                  newErrors.changeOrders = "Change Orders must be a non-negative number.";
              }

              return newErrors;
          }, []);

          const handleSubmit = useCallback(async (e) => {
              e.preventDefault();
              
              const validationErrors = validateForm(formData);
              if (Object.keys(validationErrors).length > 0) {
                  setErrors(validationErrors);
                  return;
              }
              setErrors({});

              setLoading(true);

              const entryData = {
                  date: formData.date,
                  tower: formData.tower,
                  task: formData.task,
                  hours: Number(formData.hours) || 0,
                  unitsCompleted: Number(formData.units) || 0,
                  notes: formData.notes,
                  changeOrders: Number(formData.changeOrders) || 0,
              };

              let updatedEntries;

              if (editingId) {
                  updatedEntries = entries.map((entry) =>
                      entry.id === editingId ? { ...entry, ...entryData } : entry
                  );
              } else {
                  const newEntry = {
                      ...entryData,
                      id: Date.now().toString() + Math.random().toString(36).slice(2, 9),
                  };
                  updatedEntries = [newEntry, ...entries];
              }
              
              updatedEntries.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
              setEntries(updatedEntries);
              saveToLocalStorage(updatedEntries);
              resetForm();
              setLoading(false);

          }, [formData, editingId, entries, saveToLocalStorage, resetForm, validateForm]);

          const handleDelete = useCallback((id) => {
              if (window.confirm("Are you sure you want to delete this entry?")) {
                  setEntries(currentEntries => {
                      const updatedEntries = currentEntries.filter(entry => entry.id !== id);
                      saveToLocalStorage(updatedEntries);
                      return updatedEntries;
                  });
              }
          }, [saveToLocalStorage]);

          const handleEdit = useCallback((id) => {
              const entry = entries.find((e) => e.id === id);
              if (entry) {
                  setFormData({
                      date: entry.date,
                      tower: entry.tower,
                      task: entry.task,
                      hours: String(entry.hours),
                      units: String(entry.unitsCompleted),
                      notes: entry.notes,
                      changeOrders: String(entry.changeOrders),
                  });
                  setEditingId(id);
                  setErrors({});
                  window.scrollTo({ top: 0, behavior: 'smooth' });
              }
          }, [entries]);

          const cancelEdit = useCallback(() => {
              resetForm();
          }, [resetForm]);

          const exportToCSV = useCallback(() => {
              if (entries.length === 0) {
                  alert("No entries to export.");
                  return;
              }

              const headers = ["Date", "Tower", "Task", "Hours", "Units Completed", "Notes", "Change Orders"];
              const csvContent = [
                  headers.join(","),
                  ...entries.map((entry) =>
                      [
                          entry.date,
                          entry.tower,
                          entry.task,
                          entry.hours,
                          entry.unitsCompleted,
                          `"${entry.notes.replace(/"/g, '""')}"`,
                          entry.changeOrders,
                      ].join(",")
                  ),
              ].join("\n");

              const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
              const url = URL.createObjectURL(blob);
              const a = document.createElement("a");
              a.href = url;
              a.download = `dailys-tracker-${new Date().toISOString().split("T")[0]}.csv`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
              URL.revokeObjectURL(url);
          }, [entries]);

          const summaryStats = useMemo(() => {
              return entries.reduce(
                  (acc, entry) => {
                      acc.totalHours += Number(entry.hours) || 0;
                      acc.totalUnits += Number(entry.unitsCompleted) || 0;
                      acc.totalChangeOrders += Number(entry.changeOrders) || 0;
                      return acc;
                  },
                  { totalHours: 0, totalUnits: 0, totalChangeOrders: 0 }
              );
          }, [entries]);

          return (
              <main className="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
                  <JobForm
                      formData={formData}
                      setFormData={setFormData}
                      handleSubmit={handleSubmit}
                      editingId={editingId}
                      loading={loading}
                      onExport={exportToCSV}
                      cancelEdit={cancelEdit}
                      errors={errors}
                      setErrors={setErrors}
                  />
                  <SummaryStats {...summaryStats} />
                  <JobTable
                      entries={entries}
                      handleEdit={handleEdit}
                      handleDelete={handleDelete}
                  />
              </main>
          );
      }

      // --- Final render logic from index.tsx ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
</body>
</html>
